<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mapper.errandsMapper">
	<resultMap type="errandsDTO" id="errandsMap">
		<id column="ERRANDS_NUM" property="errandsNum" />
		<result column="TITLE" property="title" />
		<result column="CONTENT" property="content" />
		<result column="END_TIME" property="endTime" />
		<result column="ARRIVAL_TIME" property="arrivalTime" />
		<result column="FINISH_TIME" property="finishTime" />
		<result column="PRODUCT_PRICE" property="productPrice" />
		<result column="ERRANDS_PRICE" property="errandsPrice" />
		<result column="ERRANDS_PHOTO" property="errandsPhoto" />
		<result column="START_TIME" property="startTime" />
		<association property="requestUser" javaType="memberDTO">
			<id column="REQUEST_ID" property="userId" />
		</association>
		<association property="responseUser" javaType="memberDTO">
			<id column="RESPONSE_ID" property="userId" />
		</association>
		<association property="errandsPos" javaType="ErrandsPosDTO">
			<result column="ADDR" property="addr" />
			<result column="LATITUDE" property="latitude" />
			<result column="LONGITUDE" property="longitude" />
		</association>
		<collection property="errandsReply" ofType="errandsReplyDTO">
			<id column="ERRANDS_REPLY_NUM" property="replyNum"/>
			<result column="REPLY_CONTENT" property="replyContent"/>
			<result column="PREDICT_TIME" property="arrivalTime"/>
			<result column="REPLY_DATE" property="replyDate"/>
			<association property="user" javaType="memberDTO">
				<id column="MEMBER_ID" property="userId"/>
			</association>
		</collection>
	</resultMap>
	<insert id="insertErrands" parameterType="errandsDTO">
		insert into
		ERRANDS(ERRANDS_NUM, TITLE, CONTENT, END_TIME,
		PRODUCT_PRICE,
		ERRANDS_PRICE, ERRANDS_PHOTO, REQUEST_ID)
		values(ERRANDS_NUM.nextval,
		#{title}, #{content}, #{endTime},
		#{productPrice}, #{errandsPrice},
		#{errandsPhoto,jdbcType=VARCHAR}, #{requestUser.userId})
	</insert>
	<select id="selectErrands" parameterType="int" resultMap="errandsMap">
		select * from ERRANDS_REPLY_VIEW
		<where>
			<if test="value != 0">
				ERRANDS_NUM = #{value}
			</if>
		</where>
		order by ERRANDS_NUM desc
	</select>
	<select id="selectNum" resultType="int">
		select ERRANDS_NUM.CURRVAL from dual
	</select>
	<delete id="deleteErrands" parameterType="int">
		delete from ERRANDS
		where ERRANDS_NUM = #{value}
	</delete>
	
	<select id="countErrands" resultType="int">
		select count(*) from ERRANDS
	</select>
</mapper>